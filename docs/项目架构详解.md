# Proxy Enhancer Ultra - é¡¹ç›®æ¶æ„è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ•´ä½“æ¶æ„](#é¡¹ç›®æ•´ä½“æ¶æ„)
2. [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
3. [é¡¹ç›®ç»“æ„åˆ†æ](#é¡¹ç›®ç»“æ„åˆ†æ)
4. [è·¯ç”±ç³»ç»ŸåŸç†](#è·¯ç”±ç³»ç»ŸåŸç†)
5. [æ•°æ®æµæ¶æ„](#æ•°æ®æµæ¶æ„)
6. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
7. [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
8. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)

## ğŸ—ï¸ é¡¹ç›®æ•´ä½“æ¶æ„

### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¿é—®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   ä»£ç†åŸŸå   â”‚  â”‚  ç®¡ç†åå°   â”‚  â”‚   APIæ¥å£   â”‚            â”‚
â”‚  â”‚   (b.com)   â”‚  â”‚  (/admin)   â”‚  â”‚   (/api)    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Go ç»Ÿä¸€æœåŠ¡å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  è·¯ç”±åˆ†å‘å™¨  â”‚  â”‚  ä¸­é—´ä»¶å±‚   â”‚  â”‚  å¤„ç†å™¨å±‚   â”‚            â”‚
â”‚  â”‚  gorilla/muxâ”‚  â”‚  JWT/CORS   â”‚  â”‚  Handlers   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ä»£ç†æœåŠ¡   â”‚  â”‚  ä¸šåŠ¡æœåŠ¡   â”‚  â”‚  æ•°æ®è®¿é—®   â”‚            â”‚
â”‚  â”‚  ReverseProxyâ”‚  â”‚  Services   â”‚  â”‚    GORM     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚   ç¼“å­˜     â”‚  â”‚   æ—¥å¿—     â”‚            â”‚
â”‚  â”‚   (æœ¬åœ°)    â”‚  â”‚   Redis     â”‚  â”‚  æ–‡ä»¶ç³»ç»Ÿ   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡ç†å¿µ
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰è¯·æ±‚é€šè¿‡åŒä¸€ä¸ª Go æœåŠ¡å¤„ç†
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„å±‚æ¬¡åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ— ä¾µå…¥ä»£ç†**ï¼šå®Œå…¨ä»£ç†ç›®æ ‡ç½‘ç«™ï¼Œä¿æŒåŸæœ‰åŠŸèƒ½
- **åŠ¨æ€æ³¨å…¥**ï¼šæ ¹æ®è§„åˆ™åŠ¨æ€æ³¨å…¥è‡ªå®šä¹‰åŠŸèƒ½

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦è§£

### åç«¯æŠ€æœ¯æ ˆ

#### 1. **Go 1.21+**
- **ç‰ˆæœ¬è¦æ±‚**ï¼šGo 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬
- **ä¼˜åŠ¿**ï¼šé«˜æ€§èƒ½ã€å¹¶å‘å¤„ç†ã€å†…å­˜ç®¡ç†
- **ç”¨é€”**ï¼šæ ¸å¿ƒæœåŠ¡é€»è¾‘ã€åå‘ä»£ç†ã€API æœåŠ¡

#### 2. **Web æ¡†æ¶**
```go
// æ ‡å‡†åº“ + gorilla/mux
import (
    "net/http"
    "github.com/gorilla/mux"
)

// è·¯ç”±æ³¨å†Œç¤ºä¾‹
router := mux.NewRouter()
router.HandleFunc("/api/auth/login", authHandler.Login).Methods("POST")
router.HandleFunc("/admin/{rest:.*}", adminHandler.ServeAdmin).Methods("GET")
router.PathPrefix("/").HandlerFunc(proxyHandler.ServeProxy)
```

#### 3. **æ•°æ®åº“ ORM**
```go
// GORM + PostgreSQL
import (
    "gorm.io/gorm"
    "gorm.io/driver/postgres"
)

// æ•°æ®åº“è¿æ¥ç¤ºä¾‹
dsn := "host=localhost user=postgres password=password dbname=proxy_platform port=5432 sslmode=disable"
db, err := gorm.Open(postgres.Open(dsn), &gorm.Config{})
```

#### 4. **è®¤è¯ç³»ç»Ÿ**
```go
// JWT è®¤è¯
import "github.com/golang-jwt/jwt/v5"

// JWT ä¸­é—´ä»¶ç¤ºä¾‹
func JWTAuthMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // JWT éªŒè¯é€»è¾‘
        token := r.Header.Get("Authorization")
        // ... éªŒè¯é€»è¾‘
        next.ServeHTTP(w, r)
    })
}
```

### å‰ç«¯æŠ€æœ¯æ ˆ

#### 1. **Vue 3 + TypeScript**
```typescript
// ç»„ä»¶ç¤ºä¾‹
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useAuthStore } from '@/store/auth'

const authStore = useAuthStore()
const loading = ref(false)

const handleLogin = async () => {
  loading.value = true
  try {
    await authStore.login(username.value, password.value)
  } finally {
    loading.value = false
  }
}
</script>
```

#### 2. **çŠ¶æ€ç®¡ç† (Pinia)**
```typescript
// store/auth.ts
import { defineStore } from 'pinia'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    user: null,
    token: null,
    isAuthenticated: false
  }),
  
  actions: {
    async login(username: string, password: string) {
      // ç™»å½•é€»è¾‘
    }
  }
})
```

#### 3. **è·¯ç”±ç³»ç»Ÿ (Vue Router 4)**
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/admin',
    component: () => import('@/views/layout/AdminLayout.vue'),
    meta: { requiresAuth: true },
    children: [
      { path: 'proxy', component: () => import('@/views/proxy/ProxyManagement.vue') },
      { path: 'rules', component: () => import('@/views/rules/RulesManagement.vue') }
    ]
  }
]
```

## ğŸ“ é¡¹ç›®ç»“æ„åˆ†æ

### ç›®å½•ç»“æ„è¯¦è§£

```
proxy-enhancer-ultra/
â”œâ”€â”€ cmd/                           # ç¨‹åºå…¥å£ç‚¹
â”‚   â””â”€â”€ server/                    # æœåŠ¡å™¨ä¸»ç¨‹åº
â”‚       â””â”€â”€ main.go               # ä¸»å‡½æ•°ï¼Œå¯åŠ¨æœåŠ¡å™¨
â”œâ”€â”€ internal/                      # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ auth/                     # è®¤è¯æ¨¡å—
â”‚   â”‚   â””â”€â”€ jwt.go               # JWT å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go            # é…ç½®ç»“æ„ä½“å’ŒåŠ è½½é€»è¾‘
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“å±‚
â”‚   â”‚   â””â”€â”€ database.go          # æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–
â”‚   â”œâ”€â”€ handlers/                 # HTTP å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ auth_handler.go      # è®¤è¯ç›¸å…³å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ proxy_handler.go     # ä»£ç†æœåŠ¡å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ rule_handler.go      # è§„åˆ™ç®¡ç†å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ ...                  # å…¶ä»–å¤„ç†å™¨
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ middleware.go        # è®¤è¯ã€CORSã€æ—¥å¿—ç­‰ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ models.go            # GORM æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ proxy/                    # ä»£ç†æœåŠ¡æ ¸å¿ƒ
â”‚   â”‚   â””â”€â”€ proxy.go             # åå‘ä»£ç†å®ç°
â”‚   â””â”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚       â”œâ”€â”€ proxy_service.go      # ä»£ç†é…ç½®æœåŠ¡
â”‚       â”œâ”€â”€ rule_service.go       # è§„åˆ™ç®¡ç†æœåŠ¡
â”‚       â””â”€â”€ ...                   # å…¶ä»–ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ pkg/                          # å…¬å…±åŒ…ï¼ˆå¯è¢«å¤–éƒ¨å¼•ç”¨ï¼‰
â”‚   â”œâ”€â”€ config/                   # é…ç½®å·¥å…·
â”‚   â”œâ”€â”€ logger/                   # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ utils/                    # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ web/                          # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/                      # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ api/                  # API æ¥å£å°è£…
â”‚   â”‚   â”œâ”€â”€ components/           # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/                # é¡µé¢è§†å›¾
â”‚   â”‚   â”œâ”€â”€ store/                # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json              # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ vite.config.ts            # Vite æ„å»ºé…ç½®
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                         # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ go.mod                        # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ go.sum                        # Go ä¾èµ–æ ¡éªŒ
â””â”€â”€ config.yaml.example           # é…ç½®æ–‡ä»¶æ¨¡æ¿
```

### æ ¸å¿ƒæ¨¡å—èŒè´£

#### 1. **cmd/server/main.go** - ç¨‹åºå…¥å£
```go
func main() {
    // 1. åŠ è½½é…ç½®
    config := config.Load()
    
    // 2. åˆå§‹åŒ–æ•°æ®åº“
    db := database.Init(config.Database)
    
    // 3. åˆå§‹åŒ–æœåŠ¡
    services := services.Init(db)
    
    // 4. è®¾ç½®è·¯ç”±
    router := setupRouter(services)
    
    // 5. å¯åŠ¨æœåŠ¡å™¨
    server := &http.Server{
        Addr:    config.Server.Address,
        Handler: router,
    }
    server.ListenAndServe()
}
```

#### 2. **internal/handlers/** - HTTP å¤„ç†å™¨
- **èŒè´£**ï¼šå¤„ç† HTTP è¯·æ±‚ï¼Œè°ƒç”¨ä¸šåŠ¡æœåŠ¡
- **ç‰¹ç‚¹**ï¼šåªè´Ÿè´£è¯·æ±‚è§£æå’Œå“åº”æ ¼å¼åŒ–
- **ç¤ºä¾‹**ï¼š
```go
func (h *ProxyHandler) CreateProxy(w http.ResponseWriter, r *http.Request) {
    var req CreateProxyRequest
    if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
        http.Error(w, "Invalid request", http.StatusBadRequest)
        return
    }
    
    proxy, err := h.proxyService.CreateProxy(r.Context(), req)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
        return
    }
    
    json.NewEncoder(w).Encode(proxy)
}
```

#### 3. **internal/services/** - ä¸šåŠ¡é€»è¾‘æœåŠ¡
- **èŒè´£**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **ç‰¹ç‚¹**ï¼šä¸ HTTP å±‚è§£è€¦ï¼Œå¯ç‹¬ç«‹æµ‹è¯•
- **ç¤ºä¾‹**ï¼š
```go
func (s *ProxyService) CreateProxy(ctx context.Context, req CreateProxyRequest) (*Proxy, error) {
    // 1. éªŒè¯è¯·æ±‚
    if err := s.validateRequest(req); err != nil {
        return nil, err
    }
    
    // 2. åˆ›å»ºä»£ç†é…ç½®
    proxy := &Proxy{
        Name:        req.Name,
        TargetURL:   req.TargetURL,
        ProxyDomain: req.ProxyDomain,
        IsActive:    false,
    }
    
    // 3. ä¿å­˜åˆ°æ•°æ®åº“
    if err := s.db.Create(proxy).Error; err != nil {
        return nil, err
    }
    
    return proxy, nil
}
```

## ğŸ›£ï¸ è·¯ç”±ç³»ç»ŸåŸç†

### è·¯ç”±å±‚æ¬¡ç»“æ„

#### 1. **ç®¡ç†åå°è·¯ç”±** (`/admin/*`)
```
/admin
â”œâ”€â”€ /admin/login          # ç™»å½•é¡µé¢
â”œâ”€â”€ /admin/proxy          # ä»£ç†ç®¡ç†é¡µé¢
â”œâ”€â”€ /admin/rules          # è§„åˆ™é…ç½®é¡µé¢
â”œâ”€â”€ /admin/data           # æ•°æ®æ”¶é›†é¡µé¢
â””â”€â”€ /admin/settings       # ç³»ç»Ÿè®¾ç½®é¡µé¢
```

#### 2. **API æ¥å£è·¯ç”±** (`/api/*`)
```
/api
â”œâ”€â”€ /api/auth
â”‚   â”œâ”€â”€ POST /login       # ç”¨æˆ·ç™»å½•
â”‚   â””â”€â”€ POST /logout      # ç”¨æˆ·ç™»å‡º
â”œâ”€â”€ /api/proxy
â”‚   â”œâ”€â”€ GET  /configs     # è·å–ä»£ç†é…ç½®åˆ—è¡¨
â”‚   â”œâ”€â”€ POST /configs     # åˆ›å»ºä»£ç†é…ç½®
â”‚   â””â”€â”€ PUT  /configs/{id} # æ›´æ–°ä»£ç†é…ç½®
â”œâ”€â”€ /api/rules            # è§„åˆ™ç®¡ç†æ¥å£
â”œâ”€â”€ /api/popups           # å¼¹çª—ç®¡ç†æ¥å£
â””â”€â”€ /api/submissions      # æ•°æ®æäº¤æ¥å£
```

#### 3. **ä»£ç†å‰å°è·¯ç”±** (`/*`)
```
/* (é€šé…ç¬¦è·¯ç”±)
â”œâ”€â”€ æ‰€æœ‰å…¶ä»–è¯·æ±‚éƒ½é€šè¿‡ä»£ç†æœåŠ¡å¤„ç†
â”œâ”€â”€ æ ¹æ®é…ç½®çš„è§„åˆ™å†³å®šæ˜¯å¦æ³¨å…¥å¼¹çª—
â””â”€â”€ è¿”å›ä»£ç†åçš„ç½‘ç«™å†…å®¹
```

### è·¯ç”±æ³¨å†Œé€»è¾‘

```go
func setupRouter(services *Services) *mux.Router {
    router := mux.NewRouter()
    
    // 1. é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆç®¡ç†åå°ï¼‰
    router.PathPrefix("/admin").HandlerFunc(adminHandler.ServeAdmin)
    
    // 2. API æ¥å£è·¯ç”±
    apiRouter := router.PathPrefix("/api").Subrouter()
    apiRouter.Use(middleware.CORS, middleware.Logging)
    
    // è®¤è¯ç›¸å…³æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰
    apiRouter.HandleFunc("/auth/login", authHandler.Login).Methods("POST")
    
    // éœ€è¦è®¤è¯çš„æ¥å£
    protectedRouter := apiRouter.PathPrefix("").Subrouter()
    protectedRouter.Use(middleware.JWTAuth)
    protectedRouter.HandleFunc("/proxy/configs", proxyHandler.GetConfigs).Methods("GET")
    protectedRouter.HandleFunc("/proxy/configs", proxyHandler.CreateConfig).Methods("POST")
    
    // 3. ä»£ç†æœåŠ¡è·¯ç”±ï¼ˆé€šé…ç¬¦ï¼Œæ”¾åœ¨æœ€åï¼‰
    router.PathPrefix("/").HandlerFunc(proxyHandler.ServeProxy)
    
    return router
}
```

### è·¯ç”±ä¼˜å…ˆçº§

1. **ç²¾ç¡®åŒ¹é…**ï¼š`/admin`, `/api`
2. **å‰ç¼€åŒ¹é…**ï¼š`/admin/`, `/api/`
3. **é€šé…ç¬¦åŒ¹é…**ï¼š`/*` (ä»£ç†æœåŠ¡)

**é‡è¦**ï¼šä»£ç†æœåŠ¡çš„é€šé…ç¬¦è·¯ç”±å¿…é¡»æ”¾åœ¨æœ€åï¼Œå¦åˆ™ä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ã€‚

## ğŸ”„ æ•°æ®æµæ¶æ„

### è¯·æ±‚å¤„ç†æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ è·¯ç”±åˆ†å‘ â†’ ä¸­é—´ä»¶å¤„ç† â†’ å¤„ç†å™¨ â†’ ä¸šåŠ¡æœåŠ¡ â†’ æ•°æ®è®¿é—® â†’ æ•°æ®åº“
    â†“           â†“           â†“         â†“         â†“         â†“         â†“
   HTTP      gorilla/mux  JWT/CORS  Handlers  Services   GORM    PostgreSQL
```

### è¯¦ç»†æµç¨‹ç¤ºä¾‹

#### 1. **ç®¡ç†åå°é¡µé¢è®¿é—®**
```
GET /admin/proxy
    â†“
è·¯ç”±åŒ¹é…: /admin/{rest:.*}
    â†“
ä¸­é—´ä»¶: CORS, Logging
    â†“
å¤„ç†å™¨: adminHandler.ServeAdmin
    â†“
è¿”å›: Vue åº”ç”¨ HTML + é™æ€èµ„æº
```

#### 2. **API æ¥å£è°ƒç”¨**
```
POST /api/auth/login
    â†“
è·¯ç”±åŒ¹é…: /api/auth/login
    â†“
ä¸­é—´ä»¶: CORS, Logging
    â†“
å¤„ç†å™¨: authHandler.Login
    â†“
ä¸šåŠ¡æœåŠ¡: authService.Authenticate
    â†“
æ•°æ®è®¿é—®: userRepository.FindByUsername
    â†“
æ•°æ®åº“: SELECT * FROM users WHERE username = ?
    â†“
è¿”å›: JWT Token + ç”¨æˆ·ä¿¡æ¯
```

#### 3. **ä»£ç†è¯·æ±‚å¤„ç†**
```
GET / (ä»»æ„è·¯å¾„)
    â†“
è·¯ç”±åŒ¹é…: /* (é€šé…ç¬¦)
    â†“
å¤„ç†å™¨: proxyHandler.ServeProxy
    â†“
ä¸šåŠ¡æœåŠ¡: proxyService.ProcessRequest
    â†“
1. è·å–ç›®æ ‡ç½‘ç«™å†…å®¹
2. æ£€æŸ¥è§¦å‘è§„åˆ™
3. æ³¨å…¥å¼¹çª—/è¡¨å•
4. è¿”å›å¢å¼ºåçš„å†…å®¹
```

### æ•°æ®æ¨¡å‹å…³ç³»

```mermaid
erDiagram
    USERS ||--o{ USER_ROLES : has
    USER_ROLES ||--|| ROLES : belongs_to
    ROLES ||--o{ ROLE_PERMISSIONS : has
    ROLE_PERMISSIONS ||--|| PERMISSIONS : belongs_to
    
    PROXY_CONFIGS ||--o{ DOMAINS : has
    PROXY_CONFIGS ||--|| TARGET_SITES : points_to
    
    RULES ||--|| TRIGGERS : has
    RULES ||--|| ACTIONS : has
    RULES ||--o{ POPUPS : triggers
    
    POPUPS ||--o{ FORMS : contains
    FORMS ||--o{ FIELDS : has
    POPUPS ||--|| STYLES : has
    
    FORMS ||--o{ SUBMISSIONS : receives
    SUBMISSIONS ||--o{ SUBMISSION_DATA : contains
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. **ä»£ç†æœåŠ¡æ¨¡å—** (`internal/proxy/`)

#### æ ¸å¿ƒåŠŸèƒ½
- åå‘ä»£ç†ç›®æ ‡ç½‘ç«™
- å†…å®¹æ³¨å…¥å’Œä¿®æ”¹
- è§„åˆ™åŒ¹é…å’Œæ‰§è¡Œ

#### å…³é”®ä»£ç ç»“æ„
```go
type ProxyService struct {
    db          *gorm.DB
    ruleService *RuleService
    config      *config.Config
}

func (s *ProxyService) ProcessRequest(w http.ResponseWriter, r *http.Request) {
    // 1. åˆ›å»ºåå‘ä»£ç†
    proxy := httputil.NewSingleHostReverseProxy(targetURL)
    
    // 2. ä¿®æ”¹å“åº”å†…å®¹
    proxy.ModifyResponse = func(resp *http.Response) error {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ³¨å…¥å¼¹çª—
        if shouldInjectPopup(r.URL.Path) {
            return injectPopup(resp)
        }
        return nil
    }
    
    // 3. æ‰§è¡Œä»£ç†
    proxy.ServeHTTP(w, r)
}
```

### 2. **è§„åˆ™å¼•æ“æ¨¡å—** (`internal/services/rule_service.go`)

#### æ ¸å¿ƒåŠŸèƒ½
- è§„åˆ™æ¡ä»¶åŒ¹é…
- è§¦å‘åŠ¨ä½œæ‰§è¡Œ
- ä¼˜å…ˆçº§ç®¡ç†

#### è§„åˆ™é…ç½®ç¤ºä¾‹
```json
{
  "name": "é¦–é¡µå¼¹çª—",
  "trigger_conditions": {
    "type": "url_pattern",
    "pattern": "^/$",
    "page_load": true
  },
  "actions": {
    "type": "inject_popup",
    "popup_id": "uuid-123",
    "delay": 3000
  },
  "priority": 1,
  "is_active": true
}
```

### 3. **å¼¹çª—æ³¨å…¥æ¨¡å—**

#### æ³¨å…¥ç­–ç•¥
1. **é¡µé¢åŠ è½½åæ³¨å…¥**ï¼šDOM åŠ è½½å®Œæˆåæ’å…¥å¼¹çª—
2. **æ»šåŠ¨è§¦å‘æ³¨å…¥**ï¼šç”¨æˆ·æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®æ—¶æ˜¾ç¤º
3. **æ—¶é—´å»¶è¿Ÿæ³¨å…¥**ï¼šé¡µé¢åŠ è½½åå»¶è¿ŸæŒ‡å®šæ—¶é—´æ˜¾ç¤º
4. **ç‚¹å‡»è§¦å‘æ³¨å…¥**ï¼šç”¨æˆ·ç‚¹å‡»ç‰¹å®šå…ƒç´ æ—¶æ˜¾ç¤º

#### æ³¨å…¥ä»£ç ç¤ºä¾‹
```javascript
// æ³¨å…¥åˆ°é¡µé¢çš„ JavaScript ä»£ç 
function injectPopup(popupConfig) {
    const popup = document.createElement('div')
    popup.innerHTML = popupConfig.html
    popup.className = 'proxy-popup'
    
    // åº”ç”¨æ ·å¼
    Object.assign(popup.style, popupConfig.styles)
    
    // æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(popup)
    
    // ç»‘å®šäº‹ä»¶
    bindPopupEvents(popup, popupConfig)
}
```

## ğŸš€ å¼€å‘ç¯å¢ƒé…ç½®

### ç¯å¢ƒè¦æ±‚
```bash
# Go ç¯å¢ƒ
go version >= 1.21.0

# Node.js ç¯å¢ƒ
node version >= 18.0.0

# æ•°æ®åº“
PostgreSQL >= 12.0
```

### å¼€å‘å¯åŠ¨æ­¥éª¤
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd proxy-enhancer-ultra

# 2. åç«¯è®¾ç½®
go mod download
cp config.yaml.example config.yaml
# ç¼–è¾‘ config.yaml é…ç½®æ•°æ®åº“è¿æ¥

# 3. å‰ç«¯è®¾ç½®
cd web
npm install

# 4. å¯åŠ¨å¼€å‘æœåŠ¡
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯
go run cmd/server/main.go

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd web && npm run dev
```

### é…ç½®æ–‡ä»¶è¯´æ˜
```yaml
# config.yaml
server:
  host: "0.0.0.0"
  port: 8080

database:
  postgres:
    host: "localhost"
    port: 5432
    user: "postgres"
    password: "password"
    dbname: "proxy_platform"
    sslmode: "disable"

jwt:
  secret: "your-secret-key"
  expires_in: 24h
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. **å•æœºéƒ¨ç½²**
```bash
# æ„å»ºåç«¯
go build -o bin/server cmd/server/main.go

# æ„å»ºå‰ç«¯
cd web && npm run build

# å¯åŠ¨æœåŠ¡
./bin/server
```

#### 2. **Docker éƒ¨ç½²**
```dockerfile
# Dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o server cmd/server/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/server .
COPY --from=builder /app/web/dist ./web/dist
CMD ["./server"]
```

#### 3. **åå‘ä»£ç†é…ç½® (Nginx)**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location /admin {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - ä½¿ç”¨è¿æ¥æ± 
   - æ·»åŠ é€‚å½“çš„ç´¢å¼•
   - å®šæœŸæ¸…ç†å†å²æ•°æ®

2. **ç¼“å­˜ç­–ç•¥**
   - è§„åˆ™é…ç½®ç¼“å­˜
   - ä»£ç†å“åº”ç¼“å­˜
   - Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®

3. **å¹¶å‘å¤„ç†**
   - è°ƒæ•´ Go çš„ GOMAXPROCS
   - ä½¿ç”¨ goroutine æ± 
   - å®ç°è¯·æ±‚é™æµ

## ğŸ“š æ€»ç»“

Proxy Enhancer Ultra æ˜¯ä¸€ä¸ªæ¶æ„æ¸…æ™°ã€æ¨¡å—åŒ–ç¨‹åº¦é«˜çš„æ™ºèƒ½åå‘ä»£ç†å¹³å°ã€‚é€šè¿‡ Go çš„é«˜æ€§èƒ½ç‰¹æ€§å’Œ Vue 3 çš„ç°ä»£åŒ–å‰ç«¯æŠ€æœ¯ï¼Œå®ç°äº†å®Œæ•´çš„ä»£ç†åŠŸèƒ½å’Œç”¨æˆ·ç®¡ç†ç•Œé¢ã€‚

### æ ¸å¿ƒä¼˜åŠ¿
- **ç»Ÿä¸€æ¶æ„**ï¼šå‰åç«¯ç»Ÿä¸€éƒ¨ç½²ï¼Œç®€åŒ–è¿ç»´
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤
- **é«˜æ€§èƒ½**ï¼šåŸºäº Go çš„å¹¶å‘å¤„ç†èƒ½åŠ›
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ’ä»¶åŒ–çš„è§„åˆ™å¼•æ“å’ŒåŠ¨ä½œç³»ç»Ÿ

### é€‚ç”¨åœºæ™¯
- ä¼ä¸šè¥é”€æ´»åŠ¨é¡µé¢å¢å¼º
- ç”¨æˆ·è°ƒç ”å’Œæ•°æ®æ”¶é›†
- ç½‘ç«™åŠŸèƒ½æ— ä¾µå…¥å¼æ‰©å±•
- ä»£ç†æœåŠ¡å®šåˆ¶åŒ–éœ€æ±‚

è¿™ä¸ªé¡¹ç›®å±•ç°äº†ç°ä»£ Web åº”ç”¨çš„æœ€ä½³å®è·µï¼Œæ— è®ºæ˜¯ä»£ç ç»„ç»‡ã€æŠ€æœ¯é€‰å‹è¿˜æ˜¯æ¶æ„è®¾è®¡éƒ½å€¼å¾—å­¦ä¹ å’Œå€Ÿé‰´ã€‚
